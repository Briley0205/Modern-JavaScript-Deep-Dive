## 📕 오늘 공부한 내용, 이렇게 정리해 봅시다. ✒

**TIL(Today I learn) 기록일** : 2022.09.21

**오늘 읽은 범위** : 38장 브라우저의 렌더링 과정

# 브라우저의 렌더링 과정

- 자바스크립트가 가장 많이 사용되는 분야는 웹 브라우저 환경에서 동작하는 웹페이지 / 어플리케이션의 클라이언트 사이드다.
- 클라이언트 사이드 자바스크립트는 브라우저에서 HTML, CSS, 자바스크립트로 작성된 텍스트 문서를 아래 이미지와 같이 파싱 및 렌더링 한다.
    - 파싱 : 파싱은 프로그래밍 언어의 문법에 맞게 작성된 텍스트 문서를 읽어 들여 실행하기 위해 텍스트 문서의 문자열을 토큰으로 분해하고 토큰에 문법적 의미와 구조를 반영하여 트리 구조의 자료구조인 파스 트리를 생성하는 일련의 과정을 말한다.
    - 렌더링 : 렌더링은 HTML, CSS, 자바스크립트로 작성된 문서를 파싱하여 브라우저에 시각적으로 출력하는 것을 말한다.

![Untitled](https://velog.velcdn.com/images%2Fwhow1101%2Fpost%2F5b4fc9e3-29ab-4677-ade6-1167e5dc6dd1%2Fchap1.png)

</br>

## HTML 파싱과 DOM 생성

- HTML 문서를 브라우저에 시작적인 픽셀로 렌더링하려면 문서를 브라우저가 이해할 수 있는 자료구조로 변환하여 메로리에 저장해야한다.
- 브라우저의 렌더링 엔진은 아래 이미지와 같은 과정을 통해 HTML 문서를 파싱하여 브라우저가 이해할 수 있는 DOM 을 생성한다.

![Untitled](https://velog.velcdn.com/images%2Fyongjin9660%2Fpost%2Fba3f1ad2-d657-4bf8-9c07-e73893013852%2Fimage.png)

1. 바이트형 → 문자열 변환
2. 문자열 → 코드의 최소 단위인 토큰
3. 토큰 → 객체로 변환하여 노드들을 생성
4. HTML 요소 간의 부자 관계를 반영하여 모든 노드들을 **트리 자료구조** 로 구성한다. 이를 **DOM** 이라 부른다.

</br>

## CSS 파싱과 CSSOM 생성

- HTML을 순차적으로 파싱하여 DOM 을 생성해나가는 중 CSS 를 로드하는 link 태그 혹은 style 태그를 만나면 DOM 생성을 일시 중단한다.
- 바이트 → 문자 → 토큰 → CSSOM 과정을 거치며 CSSOM 을 생성한다.
- CSS 파싱 완료후 HTML 파싱이 중단된 지점부터 다시 HTML 을 파싱하기 시작하며 DOM 생성을 재개한다.

</br>

## 렌더 트리 생성

- 렌더 트리는 브라우저 화면에 렌더링되는 노드만 구성된다.
    - display: none 되는 등의 노드들은 포함되지 않는다.
- 리렌더링은 비용이 많이드는, 즉 성능에 악영향을 주는 작업으로 주의가 필요하다.

</br>

## 자바스크립트 파싱과 실행

- HTML 문서를 파싱환 결과물로서 생성된 DOM 은 HTML 요소와 스타일 등을 변경할 수 있는 프로그래밍 인터페이스 **DOM API** 를 제공한다.
    - DOM API 를 사용하여 이미 생성된 DOM 을 동적으로 조작할 수 있다.
- HTML을 순차적으로 파싱하여 DOM 을 생성해나가는 중 자바스크립트 파일을 로드하는 script 등을 만나면 DOM 생성을 일시 중단한다.
- 자바스크립트 파싱과 실행은 자바스크립트 엔진이 처리한다.
- 자바스크립트 엔진은 자바스크립트를 해석하여 **AST** 를 생성한다. AST를 기반으로 인터프리터가 실행할 수 있는 중간코드인 바이트코드를 생성하여 실행한다.

> 위에서 설명한바와 같이 자바스크립트 파일을 로드하는 script 를 만나면 DOM 생성을 중단한다. 그리고 자바스크립트는 이미 생성된 DOM 을 동적으로 조작할 수 있다.  그럼으로 script 태그는 body 의 최하단에 위치하는 것이 일반적이다.

</br>

## script 태그의 async/defer 어트리뷰트

- 자바스크립트 파싱에 의한 DOM 생성 중단의 문제를 해결하기 위해 HTML5 부터는 async와 defer 어트리뷰트가 추가 되었다.

- async 어트리뷰트
    - HTML 파싱과 외부 자바스크립트 파일의 로드가 비동기적으로 동시에 실행된다. 단, 자바스크립트의 파싱과 실행은 자바스크립트 파일의 로드가 완료된 직후 진행되며, 이때 HTML 파싱이 중단된다.
- defer 어트리뷰트
    - HTML 파싱과 외부 자바스크립트 파일의 로드가 비동기적으로 동시에 실행된다. 단, 자바스크립트의 파싱과 실행은 HTML 파싱이 완료된 직후, 즉 DOM 생성이 완료된 직후 진행된다.
